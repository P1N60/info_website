<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sammenligning af Behandlinger - Vandladningsbesvær</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo"><a href="index.html">Vandladningsbesvær.dk</a></div>
                <div class="nav-group">
                    <a href="treatments.html" class="nav-btn">Behandlinger</a>
                    <a href="personal_test.html" class="nav-btn">Personlig test</a>
                    <a href="about.html" class="nav-btn">Om siden</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="comparison-page">
            <h1>Sammenligning af behandlinger</h1>
            <div class="back-button">
                <a href="treatments.html" class="btn">← Tilbage til behandlinger</a>
            </div>

            <div id="comparison-content"></div>
        </div>
    </main>
    
    <script>
        const treatmentData = {
            'tur-p': {
                name: 'TUR-P',
                fullName: 'Transurethral resektion af prostata',
                anesthesia: ['General anæstesi', '(Spinal anæstesi)'],
                hospitalStay: { value: '0-2', unit: 'dage' },
                catheterDays: { value: '1-3', unit: 'dage' },
                improvement: { value: 36, unit: '%' },
                retreatmentRisk: { value: 7, unit: '%' }
            },
            'tumt': {
                name: 'TUMT',
                fullName: 'Mikrobølgebehandling (CoreTherm)',
                anesthesia: ['Lokalbedøvelse'],
                hospitalStay: { value: '0', unit: 'dage' },
                catheterDays: { value: '28', unit: 'dage' },
                improvement: { value: 10, unit: '%' },
                retreatmentRisk: { value: 10, unit: '%' }
            },
            'tui-p': {
                name: 'TUI-P',
                fullName: 'Transurethral incision af prostata',
                anesthesia: ['General anæstesi', 'Spinal anæstesi'],
                hospitalStay: { value: '0-1', unit: 'dage' },
                catheterDays: { value: '1-2', unit: 'dage' },
                improvement: { value: 25, unit: '%' },
                retreatmentRisk: { value: 15, unit: '%' }
            },
            'pvp': {
                name: 'PVP',
                fullName: 'Transurethral prostatavarisation',
                anesthesia: ['General anæstesi', 'Spinal anæstesi'],
                hospitalStay: { value: '0-1', unit: 'dage' },
                catheterDays: { value: '1-2', unit: 'dage' },
                improvement: { value: 30, unit: '%' },
                retreatmentRisk: { value: 10, unit: '%' }
            },
            'aeep': {
                name: 'AEEP',
                fullName: 'Transurethral enukleation',
                anesthesia: ['General anæstesi'],
                hospitalStay: { value: '1-2', unit: 'dage' },
                catheterDays: { value: '2-5', unit: 'dage' },
                improvement: { value: 35, unit: '%' },
                retreatmentRisk: { value: 5, unit: '%' }
            },
            'freyer': {
                name: 'FREYER',
                fullName: 'Åben transvesikal prostatektomi',
                anesthesia: ['General anæstesi'],
                hospitalStay: { value: '3-5', unit: 'dage' },
                catheterDays: { value: '7-10', unit: 'dage' },
                improvement: { value: 40, unit: '%' },
                retreatmentRisk: { value: 3, unit: '%' }
            },
            'rasp': {
                name: 'RASP',
                fullName: 'Robotassisteret transvezikal prostatektomi',
                anesthesia: ['General anæstesi'],
                hospitalStay: { value: '2-3', unit: 'dage' },
                catheterDays: { value: '5-7', unit: 'dage' },
                improvement: { value: 38, unit: '%' },
                retreatmentRisk: { value: 4, unit: '%' }
            },
            'pae': {
                name: 'PAE',
                fullName: 'Prostataembolisering',
                anesthesia: ['Lokalbedøvelse'],
                hospitalStay: { value: '1', unit: 'dage' },
                catheterDays: { value: '3-7', unit: 'dage' },
                improvement: { value: 20, unit: '%' },
                retreatmentRisk: { value: 20, unit: '%' }
            },
            'urolift': {
                name: 'UROLIFT',
                fullName: 'Prostatic urethral lift',
                anesthesia: ['Lokalbedøvelse'],
                hospitalStay: { value: '0', unit: 'dage' },
                catheterDays: { value: '1-3', unit: 'dage' },
                improvement: { value: 15, unit: '%' },
                retreatmentRisk: { value: 25, unit: '%' }
            },
            'rezum': {
                name: 'REZUM',
                fullName: 'Rezum-behandling',
                anesthesia: ['Lokalbedøvelse'],
                hospitalStay: { value: '0', unit: 'dage' },
                catheterDays: { value: '7-14', unit: 'dage' },
                improvement: { value: 18, unit: '%' },
                retreatmentRisk: { value: 22, unit: '%' }
            }
        };

        function getSelectedTreatments() {
            const urlParams = new URLSearchParams(window.location.search);
            const treatments = urlParams.get('treatments');
            if (treatments) return treatments.split(',');
            
            const stored = localStorage.getItem('selectedTreatments');
            return stored ? JSON.parse(stored) : ['tur-p', 'tumt'];
        }

        function loadComparison() {
            const treatments = getSelectedTreatments();
            const content = document.getElementById('comparison-content');
            const validTreatments = treatments.filter(t => treatmentData[t]);
            
            if (validTreatments.length >= 2) {
                const comparisonHTML = generateComparison(validTreatments);
                content.innerHTML = comparisonHTML;
            } else {
                content.innerHTML = `
                    <div class="comparison-section">
                        <h2>Sammenligning ikke tilgængelig</h2>
                        <p>Vælg mindst 2 behandlinger fra <a href="treatments.html">behandlingssiden</a> for at sammenligne.</p>
                        <p>Tilgængelige behandlinger: ${Object.keys(treatmentData).join(', ')}</p>
                        <p>Valgte behandlinger: ${treatments.join(', ')}</p>
                    </div>
                `;
            }
        }

                function generateComparison(treatments) {
                        return generateTable(treatments);
                }

                function generateTable(treatments) {
                        const headers = treatments.map(t => `
                                <th>${treatmentData[t].name}
                                        <span class="sub-label">${treatmentData[t].fullName}</span>
                                </th>
                        `).join('');

                        const row = (label, formatter) => `
                                <tr>
                                        <td class="row-title">${label}</td>
                                        ${treatments.map(t => `<td>${formatter(t)}</td>`).join('')}
                                </tr>
                        `;

                        const formatValue = (obj) => `${obj.value}${obj.unit ? ' ' + obj.unit : ''}`;

                        const tableHTML = `
                                <div class="comparison-table-wrapper">
                                    <table class="comparison-table" role="table">
                                        <thead>
                                            <tr>
                                                <th>Faktor</th>
                                                ${headers}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${row('Bedøvelse', t => treatmentData[t].anesthesia.join('<br>'))}
                                            ${row('Indlæggelsestid (dage)', t => formatValue(treatmentData[t].hospitalStay))}
                                            ${row('KAD efter behandling (dage)', t => formatValue(treatmentData[t].catheterDays))}
                                            ${row('Forbedring af vandladningsgener (%)', t => formatValue(treatmentData[t].improvement))}
                                            ${row('Risiko for genbehandling efter 5 år', t => formatValue(treatmentData[t].retreatmentRisk))}
                                        </tbody>
                                    </table>
                                </div>
                        `;

                        return tableHTML;
                }

        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('comparison-content');
            
            if (!content) {
                console.error('comparison-content element not found!');
                return;
            }
            
            loadComparison();
        });
    </script>
</body>
</html>
